<html>
<head>
<title>
put_ctx lockup
</title>
</head>

<body>

<center>
<h1>
put_ctx lockup
</h1>
</center>

<h3>Severity</h3>
Process gets wedged, requiring reboot.

<h3>Found by</h3>
perf_fuzzer

<h3>First Seen</h3>
3.17-rc7

<h3>Most recently Seen</h3>
3.17-rc7

<h3>Reproducible</h3>
yes

<h3>Found On</h3>
core2

<h3>Linux-kernel Mailing List Report</h3>
2 October 2014: as part of the 
"perf: perf_fuzzer triggers instant reboot" thread.



<h3>Analysis

<h3>Kernel Splat</h3>

<ol>
<li>
<pre>
*** perf_fuzzer 0.29-pre *** by Vince Weaver

        Linux version 3.17.0-rc7+ x86_64
        Processor: Intel 6/23/10

        Seeding random number generator with 1412213351
        /proc/sys/kernel/perf_event_max_sample_rate currently: 25000/s
        /proc/sys/kernel/perf_event_paranoid currently: 1
        Logging perf_event_open() failures: no
        Running fsync after every syscall: no
        To reproduce, try: ./perf_fuzzer -t OCIRMQWPFpAi -s 50000 -r 1412213351

Pid=10004, sleeping 1s
==================================================
Fuzzing the following syscalls:
        mmap perf_event_open close read write ioctl fork prctl poll 
*NOT* Fuzzing the following syscalls:
        
Also attempting the following:
        busy-instruction-loop accessing-perf-proc-and-sys-files trashing-the-mmap-page 
*NOT* attempting the following:
        signal-handler-on-overflow 
==================================================
Iteration 10000
        Open attempts: 205086  Successful: 905
                EPERM : 24
                ENOENT : 1799
                E2BIG : 22400
                EBADF : 7744
                EACCES : 343
                EINVAL : 170445
                ENOSPC : 369
                EOPNOTSUPP : 1057
                Type (Hardware 202/26997)(software 324/32251)(tracepoint 107/32351)(Cache 53/25782)(cpu 187/32291)(breakpoint 32/32086)(#6 0/36)(#7 0/26)(#8 0/87)(#9 0/32)(#10 0/22)(#11 0/24)(#12 0/26)(#13 0/19)(#14 0/29)(>14 0/23027)
        Close attempts: 892  Successful: 892
        Read attempts: 912  Successful: 788
        Write attempts: 876  Successful: 0
        Ioctl attempts: 917  Successful: 431
        Mmap attempts: 905  Successful: 306
        Prctl attempts: 902  Successful: 902
        Fork attempts: 444  Successful: 444
        Poll attempts: 927  Successful: 1
        Access attempts: 972  Successful: 487
        Trash mmap attempts: 853  Successful: 853
        Overflows: 0
        SIGIOs due to RT signal queue full: 0
Iteration 20000
        Open attempts: 224787  Successful: 933
                EPERM : 16
                ENOENT : 1915
                E2BIG : 24151
                EBADF : 8724
                EACCES : 376
                EINVAL : 187128
                ENOSPC : 428
                EOPNOTSUPP : 1116
                Type (Hardware 212/29986)(software 360/35417)(tracepoint 103/35380)(Cache 55/28207)(cpu 179/35181)(breakpoint 24/35199)(#6 0/36)(#7 0/14)(#8 0/103)(#9 0/22)(#10 0/34)(#11 0/27)(#12 0/35)(#13 0/30)(#14 0/35)(>14 0/25081)
        Close attempts: 909  Successful: 909
        Read attempts: 874  Successful: 755
        Write attempts: 871  Successful: 0
        Ioctl attempts: 907  Successful: 435
        Mmap attempts: 933  Successful: 282
        Prctl attempts: 969  Successful: 969
        Fork attempts: 445  Successful: 445
        Poll attempts: 909  Successful: 0
        Access attempts: 899  Successful: 425
        Trash mmap attempts: 929  Successful: 929
        Overflows: 0
        SIGIOs due to RT signal queue full: 0
Iteration 30000
        Open attempts: 206835  Successful: 877
                EPERM : 14
                ENOENT : 1789
                E2BIG : 22562
                EBADF : 7880
                EACCES : 355
                EINVAL : 171907
                ENOSPC : 411
                EOPNOTSUPP : 1040
                Type (Hardware 175/27601)(software 359/32654)(tracepoint 106/32377)(Cache 37/25798)(cpu 182/32173)(breakpoint 18/32448)(#6 0/35)(#7 0/29)(#8 0/99)(#9 0/26)(#10 0/32)(#11 0/27)(#12 0/32)(#13 0/22)(#14 0/28)(>14 0/23454)
        Close attempts: 903  Successful: 903
        Read attempts: 917  Successful: 811
        Write attempts: 911  Successful: 0
        Ioctl attempts: 901  Successful: 407
        Mmap attempts: 877  Successful: 318
        Prctl attempts: 865  Successful: 865
        Fork attempts: 467  Successful: 467
        Poll attempts: 944  Successful: 0
        Access attempts: 898  Successful: 430
        Trash mmap attempts: 885  Successful: 885
        Overflows: 0
        SIGIOs due to RT signal queue full: 0

^C


[152447.120375] SysRq : Show backtrace of all active CPUs
[152447.124005] sending NMI to all CPUs:
[152447.124005] NMI backtrace for cpu 0
[152447.124005] CPU: 0 PID: 10004 Comm: perf_fuzzer Tainted: G        W      3.17.0-rc7+ #84
[152447.124005] Hardware name: AOpen   DE7000/nMCP7ALPx-DE R1.06 Oct.19.2012, BIOS 080015  10/19/2012
[152447.124005] task: ffff88009d1b9000 ti: ffff88009c2ec000 task.ti: ffff88009c2ec000
[152447.124005] RIP: 0010:[<ffffffff8129a837>]  [<ffffffff8129a837>] delay_tsc+0x1b/0x4e
[152447.124005] RSP: 0018:ffff88011fc03d78  EFLAGS: 00000046
[152447.124005] RAX: 0000000000000000 RBX: 0000000000002710 RCX: 000000003a2a18ef
[152447.124005] RDX: 000000000000005f RSI: 0000000000000000 RDI: 0000000000265906
[152447.124005] RBP: ffff88011fc03d78 R08: 000000003a2a194e R09: 0000000000000000
[152447.124005] R10: ffffffff81673c90 R11: 0000000000000000 R12: 0000000000000007
[152447.124005] R13: 000000000000006c R14: 0000000000000001 R15: 0000000000000046
[152447.124005] FS:  00007fb8311eb700(0000) GS:ffff88011fc00000(0000) knlGS:0000000000000000
[152447.124005] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b
[152447.124005] CR2: 00007fff79ac1648 CR3: 000000009d7f9000 CR4: 00000000000407f0
[152447.124005] DR0: 0000000001b3f000 DR1: 0000000001937000 DR2: 0000000000000000
[152447.124005] DR3: 0000000001b2e000 DR6: 00000000ffff0ff0 DR7: 0000000000000600
[152447.124005] Stack:
[152447.124005]  ffff88011fc03d88 ffffffff8129a7c9 ffff88011fc03d98 ffffffff8129a7ef
[152447.124005]  ffff88011fc03db0 ffffffff8102b4b4 ffffffff81a6e610 ffff88011fc03dc0
[152447.124005]  ffffffff8131cd31 ffff88011fc03df0 ffffffff8131d2ea ffffffff81c76110
[152447.124005] Call Trace:
[152447.124005]  <IRQ> 
[152447.124005]  [<ffffffff8129a7c9>] __delay+0xf/0x11
[152447.124005]  [<ffffffff8129a7ef>] __const_udelay+0x24/0x26
[152447.124005]  [<ffffffff8102b4b4>] arch_trigger_all_cpu_backtrace+0xc5/0xd1
[152447.124005]  [<ffffffff8131cd31>] sysrq_handle_showallcpus+0x13/0x15
[152447.124005]  [<ffffffff8131d2ea>] __handle_sysrq+0x94/0x121
[152447.124005]  [<ffffffff8131d39a>] handle_sysrq+0x23/0x25
[152447.124005]  [<ffffffff8132dd3f>] serial8250_rx_chars+0x14b/0x1b8
[152447.124005]  [<ffffffff8132de22>] serial8250_handle_irq+0x76/0xb4
[152447.124005]  [<ffffffff8132de81>] serial8250_default_handle_irq+0x21/0x24
[152447.124005]  [<ffffffff8132d132>] serial8250_interrupt+0x3d/0xb2
[152447.124005]  [<ffffffff81075f34>] handle_irq_event_percpu+0x43/0x16e
[152447.124005]  [<ffffffff8108b382>] ? clockevents_program_event+0x9d/0xb9
[152447.124005]  [<ffffffff8107609b>] handle_irq_event+0x3c/0x57
[152447.124005]  [<ffffffff81078a0d>] handle_edge_irq+0xb1/0xcb
[152447.124005]  [<ffffffff810046ce>] handle_irq+0x21/0x2a
[152447.124005]  [<ffffffff81004146>] do_IRQ+0x4e/0xc3
[152447.124005]  [<ffffffff815244aa>] common_interrupt+0x6a/0x6a
[152447.124005]  <EOI> 
[152447.124005]  [<ffffffff8107b2ce>] ? synchronize_srcu_expedited+0x15/0x15
[152447.124005]  [<ffffffff8110dffd>] ? kmem_cache_alloc_trace+0xcb/0xda
[152447.124005]  [<ffffffff8107d7f6>] ? __call_rcu.constprop.63+0x55/0x1c8
[152447.124005]  [<ffffffff8107d983>] kfree_call_rcu+0x1a/0x1c
[152447.124005]  [<ffffffff810ca0dc>] put_ctx+0x50/0x53
[152447.124005]  [<ffffffff810cb9f7>] find_get_context+0x13f/0x170
[152447.124005]  [<ffffffff810cff70>] SYSC_perf_event_open+0x47b/0x7f5
[152447.124005]  [<ffffffff810d064a>] SyS_perf_event_open+0xe/0x10
[152447.124005]  [<ffffffff81523916>] system_call_fastpath+0x1a/0x1f
[152447.124005] Code: 90 55 48 8d 3c bf 48 89 e5 e8 b1 ff ff ff 5d c3 66 66 66 66 90 55 48 89 e5 65 8b 34 25 d4 b0 00 00 66 66 90 0f ae e8 0f 31 89 c1 <66> 66 90 0f ae e8 0f 31 48 c1 e2 20 89 c0 48 09 c2 41 89 d0 29 

</pre>

</ol>


<hr>
<a href="bugs_found.html">Back to perf_fuzzer bugs found</a>

</body>
</html>
